This package is a webpack build that consumes assets generated by the visitscotland.com frontend package and integrates them into the parent Hippo CMS site.

## Setup

```
yarn install

// OR

yarn
```

This script installs the sibling frontend package's dependencies then this package's dependencies.

## Use

### Building frontend assets and generating freemarker templates

```sh
# Each of the following scripts runs one of the frontend builds before running the integration build (`build:integrate`) to integrate those assets into the Hippo site

# Uses assets produced by the `library` script (production assets, no SSR)
yarn build

# Uses assets produced by the `library:dev` script (development assets, no SSR)
yarn build:dev

# Uses assets produced by the `ssr:build` script (production assets, with SSR)
yarn build:ssr

# Uses assets produced by the `ssr:build:dev` script (development assets, with SSR)
yarn build:ssr:dev
```

```sh
# The integration build, run by itself, runs this package's webpack build to integrate existing assets
yarn build:integrate
```
Read more about the integration build and ways to modify its behaviour [here](#integration-build-only).

### Using the frontend components in the Hippo site

```html
<!-- 1. Include the Vue freemarker template for the component you want to include -->
<#include "../include/frontend/container.ftl">

<!-- 2. Include the relevant elements in the base template  -->

<head>
   <!-- These headContributions belong in the head part of the page - resource hints and style links will be inserted here -->
   <@hst.headContributions categoryIncludes="htmlHeadPreload" xhtml=true/>
   <@hst.headContributions categoryIncludes="htmlHeadStyles" xhtml=true/>
</head>

<body>
   <!-- An element bearing the data-vue-app-init attribute is the Vue app mount point (it should not be the body tag) -->
   <!-- The no-js class needs to be on the mount point or a parent element for proper rendering of styles for no-js users -->
   <div class="no-js" data-vue-app-init>
   </div>

   <!-- These headContributions belong at the end of the body - module scripts will be inerted here -->
   <@hst.headContributions categoryIncludes="htmlBodyEndScriptsFirst" xhtml=true/>
   <@hst.headContributions categoryIncludes="htmlBodyEndScripts" xhtml=true/>
   <@hst.headContributions categoryIncludes="htmlBodyEndAppInit" xhtml=true/>
</body>

<!-- 3. Reference a Vue component in the HTML markup *inside the Vue app mount element - i.e. data-vue-app-init above* -->
<vs-container fluid></vs-container>
```

### <a name="integration-build-only"></a> Running the integration build without updating the frontend assets

```sh
yarn build:integrate
```
The integration build:
   - Copies all assets contained in one of the frontend package's dist folders into the parent Hippo site's webfiles folder (at `/repository-data/webfiles/src/main/resources/site/frontend`).
   - Generates Freemarker templates for all Vue component modules, VueX store modules and the core VsApp module listed in the `manifest.json` file to the `components` subfolder, `stores` subfolder, and root, respectively, of the `frontend` Freemarker directory (`/repository-data/webfiles/src/main/resources/site/freemarker/frontend`).

By default, the assets are copied from the `../frontend/dist/library` folder. Passing the `src-path` flag to `build:integrate` informs webpack to use a different root path for the source of the frontend assets. e.g. the following will copy the SSR build products instead:

```sh
yarn build:integrate --src-path=../frontend/dist/ssr/client
```
