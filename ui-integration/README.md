This package is a webpack build that consumes the library assets generated by the VisitScotland.com frontend package and integrates them into the parent Bloomreach CMS site.

## Setup

```
yarn install

// OR

yarn
```

This script installs the sibling frontend package's dependencies then this package's dependencies.

## Use

### Building frontend assets and generating freemarker templates

```sh
# Each of the following scripts builds a version of the frontend's assets before running the integration build (`build:integrate`)

# Uses assets produced by the `library` script (production assets, no SSR)
yarn build

# Uses assets produced by the `library:dev` script (development assets, no SSR)
yarn build:dev

# Uses assets produced by the `ssr:build` script (production assets, with SSR)
yarn build:ssr

# Uses assets produced by the `ssr:build:dev` script (development assets, with SSR)
yarn build:ssr:dev
```

After running the frontend build script, the integration build:
   - Copies all assets generated by the frontend packages's build into the parent Bloomreach site's webfiles folder (at `/repository-data/webfiles/src/main/resources/site/frontend`).
   - Generates Freemarker templates for all Vue component modules, VueX store modules and the core VsApp module listed in the `manifest.json` file to the `components` subfolder, `stores` subfolder, and root, respectively, of the `frontend` Freemarker directory (`/repository-data/webfiles/src/main/resources/site/freemarker/frontend`).

### Using the frontend components in the Bloomreach site

```html
<!-- 1. Include the Vue freemarker template for the component you want to include -->
<#include "../include/frontend/container.ftl">

<!-- 2. Include the relevant elements in the base template  -->

<head>
   <!-- These headContributions belong in the head part of the page - resource hints and style links will be inserted here -->
   <@hst.headContributions categoryIncludes="htmlHeadPreload" xhtml=true/>
   <@hst.headContributions categoryIncludes="htmlHeadStyles" xhtml=true/>
</head>

<body>
   <!-- An element bearing the data-vue-app-init attribute is the Vue app mount point (it should not be the body tag) -->
   <!-- The no-js class needs to be on the mount point or a parent element for proper rendering of styles for no-js users -->
   <div class="no-js" data-vue-app-init>
   </div>

   <!-- These headContributions belong at the end of the body - module scripts will be inerted here -->
   <@hst.headContributions categoryIncludes="htmlBodyEndScriptsFirst" xhtml=true/>
   <@hst.headContributions categoryIncludes="htmlBodyEndScripts" xhtml=true/>
   <@hst.headContributions categoryIncludes="htmlBodyEndAppInit" xhtml=true/>
</body>

<!-- 3. Reference a Vue component in the HTML markup *inside the Vue app mount element - i.e. data-vue-app-init above* -->
<vs-container fluid></vs-container>
```

### Re-generating the freemarker templates without updating the frontend assets

```sh
yarn build:integrate
```

Running this integration build will run the Webpack build to copy the assets already in the default `../frontend/dist/library` folder and re-generate the freemarker templates from those assets.

Passing the `src-path` flag to `build:integrate` informs webpack to use a non-default root path for the source of the frontend assets. e.g. the following will copy the SSR build products instead:

```sh
yarn build:integrate --src-path=../frontend/dist/ssr/client
```
